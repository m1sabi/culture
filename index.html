<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <!-- Ensures the page is responsive on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>توقيت صلاة الفجر والعشاء حسب فتوى مجلس الإفتاء الأوروبي - 2015</title>

  <style>
	.outer-container {
        display: flex;
        justify-content: center;
        width: 100%;
        background-color: #f2f2f2; /* Light gray background for the page */
    }
	.inner-container {
        display: flex;
        width: 70%;
    }
    .side-column {
        width: 15%;
    }
	.text-column {
		width: 35%;
		background-color: #ffffff;
		text-align: right;
        padding: 20px;
	}
	.list-column {
      width: 35%;
	  background-color: #ffffff;
      text-align: center;
	  padding: 20px;
	}
	 .column {
	  width: 35%;
      flex: 1;
      padding: 20px;
	  text-align: center;
	  direction: rtl;
	  padding-right: 5px;
    }
	.container {
	  width: 70%;
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 100vh;
      background-color: #ffffff; /* Light gray background for the page */
	  margin: 0 auto;
    }
    .link-container-w,
    .link-container-app {
      margin: 0 10px; /* Add some margin between the images */
    }
    .link-container-w img {
      width: 40px; /* Resize the image width */
      height: auto; /* Maintain aspect ratio */
    }
    .link-container-app img {
      width: 60px; /* Resize the image width */
      height: auto; /* Maintain aspect ratio */
    }
	.spaced {
      margin-top: 10px; /* Add space above the element */
    }
	.modal {
		display: none;
		position: fixed;
		z-index: 1000;
		left: 50%;
		top: 50%;
		transform: translate(-50%, -50%);
		width: 80%;
		max-width: 400px;
		background-color: white;
		border: 2px solid #333;
		padding: 20px;
		text-align: center;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
	}
	.modal-content {
		font-size: 18px;
		font-weight: bold;
	}
	.close {
		cursor: pointer;
		float: right;
		font-size: 24px;
		font-weight: bold;
	}
	.bold-text {
      font-weight: bold;
	  font-size: 0.8rem;
	}
	.expl {
      font-weight: bold;
      font-size: 1.3rem;
    }
	.center-container {
      width: 100%; /* Full width for the entire container */
      display: flex; /* Flexbox for centering */
      justify-content: center; /* Center horizontally */
      align-items: center; /* Center vertically */
	  
    }
	#city-list-container {
		width: 30%;  /* Set width to 30% of the page */
		margin: auto; /* Center it horizontally */
		text-align: center; /* Center the content inside */
		font-size: 0.6rem;
	}
	#city-list-container2 {
		width: 70%;  /* Set width to 30% of the page */
		margin: auto; /* Center it horizontally */
		text-align: center; /* Center the content inside */
		font-size: 1rem;
		margin-bottom: 20px;
		margin-top: 20px;
	}
    body {
		display: flex;
		flex-direction: row; /* Default: two columns */
		justify-content: center;
		align-items: stretch; /* Ensure content is not clipped */
		height: auto; /* Remove fixed height */
		min-height: 100vh; /* Ensure full screen */
		margin: 0;
		direction: rtl;
		font-family: Arial, sans-serif;
		width: 100%;
	}
    h1 {
      text-align: center;
    }
    .selectors {
      text-align: center;
      margin: 20px 0;
    }
	#prevDayBtn, #nextDayBtn {
		display: none;
	}
    select, button {
      font-size: 1rem;
      margin: 0 5px;
      padding: 4px 8px;
      cursor: pointer;
    }
	.center-container button {
      height: 35px; /* Set the height of the button */
      margin-top: 3px; /* Add margin at the top */
      margin-bottom: 3px; /* Add margin at the bottom */
    }

    /* Table layout */
    table {
      border-collapse: collapse;
      margin: 20px auto; /* center horizontally */
      width: 300px;
      max-width: 100%; /* so it doesn't overflow on small screens */
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
      width: 120px;
    }
    .row-separator {
      border-bottom: 2px solid red; /* example style */
    }
    .gr {
      color: green;
	  font-weight: bold;
    }

    .centered {
      text-align: center;
    }
	#tawkeet {
		margin: auto; /* Center it horizontally */
		text-align: center; /* Center the text */
		font-size: 3.0rem;
	}
	
	 

	
    /* Media query for smaller screens */
    @media (max-width: 600px) {
      body {
		width: 100%;
        margin: 10px;
      }
      .outer-container {
        flex-direction: column;
        align-items: center;
        width: 100%;
        margin: 10px;
    }
  	  .inner-container {
        width: 100%;
        flex-direction: column;
        align-items: center;
      }
	  .side-column {
        width: 0%;
    }
      select, button {
        font-size: 0.9rem; /* slightly smaller text on small screens */
      }
      table {
        width: 100%; /* use full width on mobile */
      }
	    #city-list-container {
		width: 100%; /* Full width on mobile */
		color: blue;
		font-size: 0.5rem;
	  }
		#city-list-container2 {
		width: 100%; /* Full width on mobile */
		color: blue;
		font-size: 0.9rem;
	  }
	  body {
		flex-direction: column; /* Stack elements on mobile */
		align-items: center;
	  }

	  .text-column {
		width: 0%;
      }
	  .column {
        width: 70% !important; /* Ensure full width */
        padding: 10px;
		text-align: center;
	  }

	  .list-column {
		width: 60%;
        order: unset; /* Reset ordering for smaller screens */
        padding: 10px;
        text-align: center;
      }
	  .expl {
		font-weight: bold;
		font-size: 1rem;
      }
    }
  </style>
</head>
<body>

<div class="outer-container">
<div class="side-column"></div>
<!-- Right column (Prayer Time Content) -->
<div class="column text-column">
  <div class="content-box">

	<p class="centered">
توقيت صلاة الفجر والعشاء حسب فتوى مجلس الإفتاء الأوروبي - 2015
<br><span class="gr centered">طيلة أيام شهر رمضان المبارك</span>
<br><span>حسب قاعدة ساعة و5 دقائق - قبل الشروق .. وبعد الغروب</span></p>

<p class="centered">
  
</p>

 <!-- <div id="city-list-container"></div>--> 
<div class="selectors">
    <!-- City selector -->
    <label for="citySelect">اختر المدينة:</label>
    <select id="citySelect"></select>
	
  <p style="text-align: center; font-weight: bold; margin-top: 10px;";>
    Latitude (خط العرض): <span id="latitudeCell">—</span>
  </p>


    <!-- Day controls: prev day button, day select, next day button -->
    <button id="prevDayBtn">اليوم السابق ←</button>
    <select id="daySelect"></select>
    <button id="nextDayBtn">→ اليوم التالي</button>
</div>

  <!-- Table to show the chosen city/day times -->
  
  
  <table>
    <tr>
      <th>اليوم</th>
      <td id="selectedDayCell">—</td>
      <th>Makka-Fotor (فطور مكة)</th>
    </tr>
    <tr>
      <th>الشروق</th>
      <td id="sunriseCell">—</td>
      <td>—</td>
    </tr>
    <tr class="row-separator">
      <th>الفجر</th>
      <td id="fajrCell">—</td>
      <td>—</td>
    </tr>
    <tr>
      <th>الغروب</th>
      <td id="sunsetCell">—</td>
      <td id="makkaFotorCell" class="green-text">—</td>
	  
    </tr>
    <tr>
      <th>العشاء</th>
      <td id="ishaaCell">—</td>
      <td>—</td>
    </tr>
  </table>
  
<p id="city-list-container2">
    توقيت الفطور قياساً إلى مكة للمدن الواقعة شمال خط العرض 49 يكون فارقاً فقط في اليوم غير الطبيعي، أي الذي يزيد طول النهار فيه على 18 ساعة، أما في الشتاء فقد يتساويان أو يكون النهار هنا أقصر
	<br><br>
	<span class="bold-text";>ملاحظة: لإصدار صوت الأذان يجب منح الإذن لمتصفح الإنترنت</span>
</p>



  <script src="cities-data.js"></script>
  <script>
    // Now we can access `allCitiesData` from cities-data.js
    console.log(allCitiesData.stuttgart);
  </script>
  <!-- read the list of cities -->
  <script>
    // cityListHtml is now available here
    document.addEventListener("DOMContentLoaded", () => {
      // 1) Create a container or target element
      const cityListContainer = document.getElementById("city-list-container");
      // 2) Insert the HTML from cities-data.js
      cityListContainer.innerHTML = cityListHtml;
    });
  </script>
  <script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js")
            .then(reg => console.log("Service Worker Registered ✅", reg))
            .catch(err => console.error("Service Worker Registration Failed ❌", err));
    }
  </script>
  <script>
    // ========================= DOM REFERENCES =========================
    const citySelect   = document.getElementById("citySelect");
    const daySelect    = document.getElementById("daySelect");
    const prevDayBtn   = document.getElementById("prevDayBtn");
    const nextDayBtn   = document.getElementById("nextDayBtn");

    const selectedDayCell = document.getElementById("selectedDayCell");
    const sunriseCell     = document.getElementById("sunriseCell");
    const sunsetCell      = document.getElementById("sunsetCell");
    const fajrCell        = document.getElementById("fajrCell");
    const ishaaCell       = document.getElementById("ishaaCell");

    // ========================= UTILITY FUNCTIONS =========================
    function timeToMinutes(t) {
      // "HH:MM" -> total minutes
      const [hh, mm] = t.split(":").map(Number);
      return hh * 60 + mm;
    }
    function minutesToTime(m) {
      // total minutes -> "HH:MM" (24h)
      const hh = Math.floor(m / 60);
      const mm = m % 60;
      // Pad with leading zeros if needed
      return String(hh).padStart(2, "0") + ":" + String(mm).padStart(2, "0");
    }
    function subtract1h05(timeStr) {
      return minutesToTime(timeToMinutes(timeStr) - 65);
    }
    function add1h05(timeStr) {
      return minutesToTime(timeToMinutes(timeStr) + 65);
    }

    // ========================= High Latitude Data =========================
    // List of city keys with latitude >= 49°
    const highLatCities = [
      "dortmund", "bremen", "duesseldorf", "essen", "leipzig",
      "berlin", "nuremberg", "karlsruhe", "mannheim", "frankfurt",
      "kiel", "hamburg", "koblenz", "regensburg", "erfurt",
      "rostock", "flensburg", "sibbhult", "kristianstad"
    ];
    // Makkah's sunrise and sunset times for days 1–30 (March 2025)
    

    // ========================= LOGIC: UPDATE THE TABLE =========================
    function updateTable() {
    const city = citySelect.value.toLowerCase(); // Ensure city key matches data
    const day = parseInt(daySelect.value, 10);

    console.log("Selected City:", city); // Debugging log
    console.log("City Data:", allCitiesData[city]); // Debugging log
    console.log("Latitude Data:", cityLatitude[city]); // Debugging log

    if (!allCitiesData[city]) {
        console.error("City not found in allCitiesData");
        return;
    }

    const found = allCitiesData[city].find(item => item.day === day);
    if (!found) {
        console.warn(`No data for day ${day} in city ${city}`);
        return;
    }

    selectedDayCell.textContent = `يوم ${day} مارس 2025`;
    sunriseCell.textContent = found.sunrise;
    sunsetCell.textContent = found.sunset;

    const fajr = subtract1h05(found.sunrise);
    const ishaa = add1h05(found.sunset);
    fajrCell.textContent = fajr;
    ishaaCell.textContent = ishaa;

      // If high-latitude city, calculate Makka-based iftar time; otherwise blank
      if (highLatCities.includes(city)) {
        const makkaDayData = makkahData.find(item => item.day === day);
        if (makkaDayData) {
          const makkaFajr = subtract1h05(makkaDayData.sunrise);
          // Duration of fast in Makkah (minutes)
          let makkaFastMin = timeToMinutes(makkaDayData.sunset) - timeToMinutes(makkaFajr);
          if (makkaFastMin < 0) makkaFastMin += 24 * 60;
          // Add Makkah fast duration to the city’s Fajr (in minutes)
          const cityFajrMin = timeToMinutes(fajr);
          let makkaIftarMin = cityFajrMin + makkaFastMin;
          if (makkaIftarMin >= 24 * 60) makkaIftarMin -= 24 * 60;
          const makkaIftar = minutesToTime(makkaIftarMin);
          document.getElementById("makkaFotorCell").textContent = makkaIftar;
        }
      } else {
        document.getElementById("makkaFotorCell").textContent = "—";
      }

      // Enable/disable day navigation arrows at boundaries
      const minDay = 1;
      const maxDay = 30;
      prevDayBtn.disabled = (day <= minDay);
      nextDayBtn.disabled = (day >= maxDay);
    }

    // ========================= ARROW HANDLERS =========================
    function goPrevDay() {
      let d = parseInt(daySelect.value, 10);
      if (d > 1) {
        daySelect.value = (d - 1).toString();
        updateTable();
      }
    }
    function goNextDay() {
      let d = parseInt(daySelect.value, 10);
      if (d < 30) {
        daySelect.value = (d + 1).toString();
        updateTable();
      }
    }

    // ========================= EVENT LISTENERS =========================
    citySelect.addEventListener("change", () => {
      // When user changes city, reset day to 1 for simplicity
      daySelect.value = "1";
      updateTable();
    });
    daySelect.addEventListener("change", updateTable);
    prevDayBtn.addEventListener("click", goPrevDay);
    nextDayBtn.addEventListener("click", goNextDay);

    // ========================= INITIALIZE DEFAULT SELECTION =========================
    citySelect.value = cityNames[0];   // default to first city
    daySelect.value = "1";            // default to day 1
    updateTable();
  </script>

  <!-- Container for city list (inserted via script) -->
  

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);
		let cityKey = city.toLowerCase(); // Normalize city name
		if (cityLatitude[cityKey]) {
			latitudeCell.textContent = `${cityLatitude[cityKey].lat}°`;
		} else {
			latitudeCell.textContent = "—";
		}

		if (cityLatitude[city]) {
			latitudeCell.textContent = `${cityLatitude[city].lat}°`;
		} else {
			latitudeCell.textContent = "—";
		}
		localStorage.setItem("selectedCity", city);
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
		}
	});

	nextDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
		}
    });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");

      // Populate the city dropdown
      for (let city in allCitiesData) {
        let option = document.createElement("option");
        option.value = city;
        option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        citySelect.appendChild(option);
      }

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);

        localStorage.setItem("selectedCity", city);
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");

      // Populate city dropdown
      for (let city in allCitiesData) {
        let option = document.createElement("option");
        option.value = city;
        option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        citySelect.appendChild(option);
      }

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);

        localStorage.setItem("selectedCity", city);

        // Calculate Maghrib for high latitude cities (>= 49°)
        if (highLatCities.includes(city)) {
          const makkahDayData = makkahData.find(item => item.day === day);
          const makkahFajrData = makkahFajr.find(item => item.day === day);
          if (makkahDayData && makkahFajrData) {
            const makkahSunset = makkahDayData.sunset;
            const makkahFajrTime = makkahFajrData.Fajr;

            // Compute fasting duration in Makkah (in minutes)
            let makkahFastMin = timeToMinutes(makkahSunset) - timeToMinutes(makkahFajrTime);
            if (makkahFastMin < 0) makkahFastMin += 24 * 60;

            // Compute Maghrib time for the city
            const cityFajrMin = timeToMinutes(fajr);
            let cityMaghribMin = cityFajrMin + makkahFastMin;
            if (cityMaghribMin >= 24 * 60) cityMaghribMin -= 24 * 60;

            const cityMaghrib = minutesToTime(cityMaghribMin);
            makkaFotorCell.textContent = cityMaghrib;
          } else {
            makkaFotorCell.textContent = "—";
          }
        } else {
          makkaFotorCell.textContent = "—";
        }
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");

      // Populate city dropdown
      for (let city in allCitiesData) {
        let option = document.createElement("option");
        option.value = city;
        option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        citySelect.appendChild(option);
      }

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);

        localStorage.setItem("selectedCity", city);

        // Display Latitude and Altitude
		if (cityLatitude[city]) {
			latitudeCell.textContent = `${cityLatitude[city].lat}°`;
			altitudeCell.textContent = `${cityLatitude[city].alt}m`;
		} else {
			latitudeCell.textContent = "—";
			altitudeCell.textContent = "—";
		}


        // Calculate Maghrib for high latitude cities (>= 49°)
        if (highLatCities.includes(city)) {
          const makkahDayData = makkahData.find(item => item.day === day);
          const makkahFajrData = makkahFajr.find(item => item.day === day);
          if (makkahDayData && makkahFajrData) {
            const makkahSunset = makkahDayData.sunset;
            const makkahFajrTime = makkahFajrData.Fajr;

            // Compute fasting duration in Makkah (in minutes)
            let makkahFastMin = timeToMinutes(makkahSunset) - timeToMinutes(makkahFajrTime);
            if (makkahFastMin < 0) makkahFastMin += 24 * 60;

            // Compute Maghrib time for the city
            const cityFajrMin = timeToMinutes(fajr);
            let cityMaghribMin = cityFajrMin + makkahFastMin;
            if (cityMaghribMin >= 24 * 60) cityMaghribMin -= 24 * 60;

            const cityMaghrib = minutesToTime(cityMaghribMin);
            makkaFotorCell.textContent = cityMaghrib;

            // Compare Makka-based Maghrib with the city's sunset
            const citySunsetMin = timeToMinutes(found.sunset);
            if (cityMaghribMin < citySunsetMin) {
              makkaFotorCell.style.color = "green";
              makkaFotorCell.style.fontWeight = "bold";
            } else {
              makkaFotorCell.style.color = "black";
              makkaFotorCell.style.fontWeight = "normal";
            }
          } else {
            makkaFotorCell.textContent = "—";
          }
        } else {
          makkaFotorCell.textContent = "—";
        }
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");
		daySelect.innerHTML = "";
      // Populate city dropdown
      for (let city in allCitiesData) {
        let option = document.createElement("option");
        option.value = city;
        option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        citySelect.appendChild(option);
      }

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);

        localStorage.setItem("selectedCity", city);
		
        // Display Latitude
        if (cityLatitude[city]) {
			latitudeCell.textContent = `${cityLatitude[city].lat}°`;
		} else {
			latitudeCell.textContent = "—";
		}
		
		document.addEventListener("DOMContentLoaded", () => {
    const citySelect = document.getElementById("citySelect");
    const latitudeCell = document.getElementById("latitudeCell");
    const latitudeMessage = document.getElementById("latitudeMessage");
	if (latitudeMessage) {
		latitudeMessage.textContent = "يتم عرض فطور مكة فقط للمدن الواقعة شمال خط العرض 49";
	}
    function updateTable() {
        const city = citySelect.value.toLowerCase();
		const latitudeMessage = document.getElementById("latitudeMessage");
		if (latitudeMessage) {
			latitudeMessage.textContent = "يتم عرض فطور مكة فقط للمدن الواقعة شمال خط العرض 49";
		}

		if (cityLatitude[city]) {
			latitudeCell.textContent = `${cityLatitude[city].lat}°`;

        // Display the message
			latitudeMessage.textContent = "يتم عرض فطور مكة فقط للمدن الواقعة شمال خط العرض 49";
			latitudeMessage.style.display = "block"; // Ensure it's visible
		} else {
			latitudeCell.textContent = "—";
			latitudeMessage.textContent = ""; // Hide the message
		}
    }

    citySelect.addEventListener("change", updateTable);
});

		
        // Calculate Maghrib for high latitude cities (>= 49°)
        if (highLatCities.includes(city)) {
          const makkahDayData = makkahData.find(item => item.day === day);
          const makkahFajrData = makkahFajr.find(item => item.day === day);
          if (makkahDayData && makkahFajrData) {
            const makkahSunset = makkahDayData.sunset;
            const makkahFajrTime = makkahFajrData.Fajr;

            // Compute fasting duration in Makkah (in minutes)
            let makkahFastMin = timeToMinutes(makkahSunset) - timeToMinutes(makkahFajrTime);
            if (makkahFastMin < 0) makkahFastMin += 24 * 60;

            // Compute Maghrib time for the city
            const cityFajrMin = timeToMinutes(fajr);
            let cityMaghribMin = cityFajrMin + makkahFastMin;
            if (cityMaghribMin >= 24 * 60) cityMaghribMin -= 24 * 60;

            const cityMaghrib = minutesToTime(cityMaghribMin);
            makkaFotorCell.textContent = cityMaghrib;

            // Compare Makka-based Maghrib with the city's sunset
            const citySunsetMin = timeToMinutes(found.sunset);
            if (cityMaghribMin < citySunsetMin) {
              makkaFotorCell.style.color = "green";
              makkaFotorCell.style.fontWeight = "bold";
            } else {
              makkaFotorCell.style.color = "black";
              makkaFotorCell.style.fontWeight = "normal";
            }
          } else {
            makkaFotorCell.textContent = "—";
          }
        } else {
          makkaFotorCell.textContent = "—";
        }
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
        prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert srting to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");

      // Populate city dropdown
      for (let city in allCitiesData) {
        let option = document.createElement("option");
        option.value = city;
        option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        citySelect.appendChild(option);
      }

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      function updateTable() {
        const city = citySelect.value.toLowerCase();
        const day = parseInt(daySelect.value, 10);
        const cityData = allCitiesData[city];
        if (!cityData) return;

        const found = cityData.find(item => item.day === day);
        if (!found) return;

        selectedDayCell.textContent = `يوم ${day} مارس 2025`;
        sunriseCell.textContent = found.sunrise;
        sunsetCell.textContent = found.sunset;

        const fajr = subtract1h05(found.sunrise);
        const ishaa = add1h05(found.sunset);
        fajrCell.textContent = fajr;
        ishaaCell.textContent = ishaa;

        prevDayBtn.disabled = (day <= 1);
        nextDayBtn.disabled = (day >= 30);

        localStorage.setItem("selectedCity", city);

        // Display Latitude based on selected city
        if (cityLatitude[city]) {
			latitudeCell.textContent = `${cityLatitude[city].lat}°`;
		} else {
			latitudeCell.textContent = "—";
		}

        // Calculate Maghrib for high latitude cities (>= 49°)
        if (highLatCities.includes(city)) {
          const makkahDayData = makkahData.find(item => item.day === day);
          const makkahFajrData = makkahFajr.find(item => item.day === day);
          if (makkahDayData && makkahFajrData) {
            const makkahSunset = makkahDayData.sunset;
            const makkahFajrTime = makkahFajrData.Fajr;

            // Compute fasting duration in Makkah (in minutes)
            let makkahFastMin = timeToMinutes(makkahSunset) - timeToMinutes(makkahFajrTime);
            if (makkahFastMin < 0) makkahFastMin += 24 * 60;

            // Compute Maghrib time for the city
            const cityFajrMin = timeToMinutes(fajr);
            let cityMaghribMin = cityFajrMin + makkahFastMin;
            if (cityMaghribMin >= 24 * 60) cityMaghribMin -= 24 * 60;

            const cityMaghrib = minutesToTime(cityMaghribMin);
            makkaFotorCell.textContent = cityMaghrib;

            // Compare Makka-based Maghrib with the city's sunset
            const citySunsetMin = timeToMinutes(found.sunset);
            if (cityMaghribMin < citySunsetMin) {
              makkaFotorCell.style.color = "green";
              makkaFotorCell.style.fontWeight = "bold";
            } else {
              makkaFotorCell.style.color = "black";
              makkaFotorCell.style.fontWeight = "normal";
            }
          } else {
            makkaFotorCell.textContent = "—";
          }
        } else {
          makkaFotorCell.textContent = "—";
        }
      }

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>
  
  <audio id="azanSound" src="hasan.mp3" preload="auto"></audio>
  
  <!-- To test Athan sound manually
  <button onclick="playAzan(); showNotification('Test Alarm');">
    🔔 Test Maghrib Alarm
  </button><br>
	 -->
	 
<div class="center-container"><button onclick="stopAzan()">⏹️ Stop Azan</button></div>
<div id="prayerPopup" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p id="prayerMessage"></p>
    </div>
</div>
<script>
// Get the Azan sound element
const azanSound = document.getElementById("azanSound");

// Register Service Worker for Push Notifications
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
    .then(reg => console.log("✅ Service Worker Registered:", reg))
    .catch(err => console.error("❌ Service Worker Error:", err));
}

// Notification permission request
document.addEventListener("DOMContentLoaded", () => {
    if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                console.log("🔔 Notification permission granted.");
            } else {
                console.log("❌ Notifications blocked by user.");
            }
        });
    } else {
        console.log("❌ Notifications are not supported in this browser.");
    }

    setInterval(checkPrayerTime, 15000); // Check every 15 sec
});

// Prevent multiple Azan triggers
let lastPlayedPrayer = "";  
let cooldown = false;

// Function to play Azan
function playAzan() {
    if (azanSound) {
        azanSound.play().catch(error => {
            console.log("🔇 Audio playback failed:", error);
        });
    }
}

// Function to stop Azan
function stopAzan() {
    if (azanSound) {
        azanSound.pause();
        azanSound.currentTime = 0;
    }
}

// Show Web Notification
function showNotification(prayerName) {
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.ready.then(reg => {
            reg.showNotification(`📢 ${prayerName} Time!`, {
                body: `It's time for ${prayerName}. Click to stop Azan.`,
                icon: "azan_icon.png",
                vibrate: [200, 100, 200],
                actions: [{ action: "stop", title: "Stop Azan" }]
            });
        });
    }
}

// Display Popup Message
function showPopup(message) {
    document.getElementById("prayerMessage").textContent = message;
    document.getElementById("prayerPopup").style.display = "block";
}

document.querySelector(".close").addEventListener("click", function () {
    document.getElementById("prayerPopup").style.display = "none";
});

// Check Prayer Time
function checkPrayerTime() {
    if (cooldown) return; // Stop checking if cooldown is active

    const now = new Date();
    const currentTime = now.getHours().toString().padStart(2, "0") + ":" + now.getMinutes().toString().padStart(2, "0");

    const maghribTime = document.getElementById("sunsetCell").textContent.trim();
    const fajrTime = document.getElementById("fajrCell").textContent.trim();

    if (currentTime === fajrTime && lastPlayedPrayer !== "Fajr") {
        triggerAzan("Fajr");
    } 
    else if (currentTime === maghribTime && lastPlayedPrayer !== "Maghrib") {
        triggerAzan("Maghrib");
    } 
    else if (currentTime !== fajrTime && currentTime !== maghribTime) {
        lastPlayedPrayer = ""; // Reset flag
    }
}

// Function to Trigger Azan & Notification
function triggerAzan(prayerName) {
    playAzan();
    showNotification(prayerName);
    showPopup(`📢 وقت ${prayerName}! حان الآن وقت صلاة ${prayerName}.`);

    lastPlayedPrayer = prayerName; // Prevent multiple triggers
    cooldown = true; // Activate cooldown

    pauseChecking(); // Stop checking temporarily
}

// Stop checking for 2 minutes after Azan
function pauseChecking() {
    console.log("⏸️ Checking paused for 2 minutes...");
    clearInterval(checkInterval);

    setTimeout(() => {
        cooldown = false; // Re-enable checking
        checkInterval = setInterval(checkPrayerTime, 15000); // Restart checking
        console.log("▶️ Checking resumed!");
    }, 120000); // 2-minute cooldown
}

// Handle Messages from Service Worker (Stop Azan if user clicks notification)
navigator.serviceWorker.addEventListener("message", (event) => {
    if (event.data.action === "stopAzan") {
        stopAzan();
    }
});
</script>

<script>
	let wakeLock = null;

async function requestWakeLock() {
    if ("wakeLock" in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request("screen");
            console.log("🔋 Wake Lock enabled!");
        } catch (err) {
            console.error("⚠️ Wake Lock failed:", err);
        }
    }
}

// Request wake lock when page loads
document.addEventListener("visibilitychange", async () => {
    if (document.visibilityState === "visible" && wakeLock === null) {
        await requestWakeLock();
    }
});

</script>
</div>
</div>

<!-- Left column (Links) -->
<div class="column list-column">

    <a href="explain.html" class="expl">ماذا تعرف عن قاعدة ساعة و5 دقائق؟</a><br>
    <p class="expl"><span class="expl">تحميل متصفح موزيلا Mozilla firefox</span></p>
	<div class="link-container-w">
		<a href="https://www.mozilla.org/en-US/firefox/browsers/windows-64-bit/">
		<img src="images\windows.png" alt="Download firefox for windows-64-bit/"></a>
	</div>
	<div class="link-container-app spaced">
		<a href="https://apps.apple.com/us/app/firefox-private-safe-browser/id989804926">
		<img src="images\App Store.png" alt="Download on the App Store"></a>
	</div>
	<div class="link-container-app spaced">
		<a href="https://play.google.com/store/apps/details?id=org.mozilla.firefox">
		<img src="images/Google Play.png" alt="GET IT ON Google Play"></a>
	</div>
</div>
 <div class="side-column"></div>


</body>
</html>
